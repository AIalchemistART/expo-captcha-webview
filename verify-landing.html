<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to Mystical Bible Companion!</title>
  <style>
    body {
      background: linear-gradient(135deg, #2A004B 0%, #ffe066 100%);
      color: #2A004B;
      font-family: 'Cardo', serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(42,0,75,0.15);
      padding: 40px 32px 32px 32px;
      max-width: 420px;
      margin: 32px auto;
      text-align: center;
    }
    h1 {
      color: #2A004B;
      font-size: 2.2rem;
      margin-bottom: 12px;
    }
    .premium {
      color: #bfae66;
      font-weight: bold;
      font-size: 1.3rem;
    }
    ul {
      text-align: left;
      margin: 20px 0 28px 0;
      padding-left: 20px;
      color: #3D0066;
    }
    li {
      margin-bottom: 10px;
      font-size: 1.1rem;
    }
    .cta {
      background: #2A004B;
      color: #ffe066;
      border: none;
      border-radius: 8px;
      padding: 12px 32px;
      font-size: 1.1rem;
      font-family: 'Cardo', serif;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.2s;
      text-decoration: none;
      display: inline-block;
    }
    .cta:hover {
      background: #bfae66;
      color: #2A004B;
    }
    .logo {
      width: 112px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img class="logo" src="https://www.dropbox.com/scl/fi/roubr9818ee23wy0ycgs3/ChatGPT-Image-Apr-22-2025-01_06_18-AM2.png?rlkey=2quywh1kmo67qwwap3f0ql1dc&st=k8a2ljls&raw=1" alt="Mystical Bible Companion Logo">
    <h1>Account Verified!</h1>
    <div class="premium">Welcome to Mystical Bible Companion</div>
    <p class="note">If you are seeing this page, simply open this link on your mobile device with the Mystical Bible Companion app installed. The app should open automatically to complete your password reset.<br>If nothing happens, make sure you have the app installed and try again from your mobile device.<br>If you are on a desktop, please open this email on your phone or tablet.</p>
    <p style="color:#ffe066;font-size:14px;font-family:serif;margin-top:24px;">Blessings,<br>The Mystical Bible Companion Team</p>
    <p style="color:#bfae66;font-size:12px;font-family:sans-serif;margin-top:16px;">&copy; 2025 Mystical Bible Companion</p>
    <script>
      // Debug message on page
      function getQueryParam(name) {
        const url = new URL(window.location.href);
        let value = url.searchParams.get(name);
        if (value) return value;
        if (url.hash) {
          const hashParams = new URLSearchParams(url.hash.slice(1));
          value = hashParams.get(name);
          if (value) return value;
        }
        return null;
      }
      window.onload = function() {
        var token = getQueryParam('access_token') || getQueryParam('token') || getQueryParam('refresh_token');
        var debugDiv = document.createElement('div');
        debugDiv.style.color = '#bfae66';
        debugDiv.style.fontSize = '12px';
        debugDiv.style.marginTop = '20px';
        if (token) {
          debugDiv.textContent = 'Token found: ' + token.substring(0,12) + '...';
        } else {
          debugDiv.textContent = 'No token found in URL.';
        }
        document.querySelector('.container').appendChild(debugDiv);
      }
    </script>
      <li>Ad-free, serene experience</li>
    </ul>
    <a class="cta" href="https://play.google.com/store/apps/details?id=com.aialchemist.mysticalbiblecompanion" target="_blank">Open the App</a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
  <script>
    // TODO: Fill in your Supabase project URL and anon key
    const SUPABASE_URL = 'https://wweuiqbrnzjrassbztob.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3ZXVpcWJybnpqcmFzc2J6dG9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUwMzc2NjEsImV4cCI6MjA2MDYxMzY2MX0.KR7Tmruc3_jE57eMVrWeilyvVtAqF_pC8HpvKlVo-S4';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    async function finalizeSession() {
      const accessToken = getParam('access_token');
      const refreshToken = getParam('refresh_token');
      const type = getParam('type');
      const messageBox = document.createElement('div');
      messageBox.style.marginTop = '20px';
      messageBox.style.fontFamily = 'Cardo, serif';
      messageBox.style.fontSize = '1rem';
      messageBox.style.color = '#2A004B';
      const container = document.querySelector('.container');

      if (type === 'email_change' && accessToken && refreshToken) {
        try {
          const { data, error } = await supabase.auth.setSession({
            access_token: accessToken,
            refresh_token: refreshToken,
          });
          if (error) {
            messageBox.textContent = 'There was an error completing your email change. Please try again or contact support.';
            messageBox.style.color = '#c00';
          } else {
            messageBox.textContent = 'Your email has been changed successfully! You may now return to the app.';
            messageBox.style.color = '#2A004B';
          }
        } catch (e) {
          messageBox.textContent = 'Unexpected error: ' + e.message;
          messageBox.style.color = '#c00';
        }
      } else {
        // Not an email change or missing tokens
        messageBox.textContent = '';
      }
      if (container && messageBox.textContent) {
        container.appendChild(messageBox);
      }
    }
    finalizeSession();
  </script>
</body>
</html>
